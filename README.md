# Malware-Analysis
Malware Analysis Lab with REMNUX. Performed Static Analysis.
## Objective
Utilize REMnux to perform static analysis on a malicious file, aiming to identify its characteristics, functionality, and potential threats without executing the file. This analysis will involve examining the file's structure, extracting embedded data, and leveraging specialized tools to understand its code and behavior.

### Skills Learned
- Static Analysis Techniques: Mastered methods for analyzing malware without execution, ensuring a safe examination environment.
- File Disassembly and Decompilation: Learned to disassemble and decompile binaries to understand the underlying code and functionality.
- Tool Proficiency: Gained expertise in using REMnux tools such as strings, hexdump, binwalk, and others for in-depth file analysis.
- Hex and Binary Analysis: Analyzed the hexadecimal and binary content of files to uncover hidden information and embedded data.
- Reporting: Enhanced skills in documenting findings and creating detailed reports on malware characteristics and potential threats.

### Tools Used
- scdbg: Analyzed shellcode and identified potential entry points and functions.
- xxd: Viewed file content in hexadecimal format.
- rtfobj: Extracted embedded objects from RTF files.
- ExifTool: Extracted and analyzed file timestamps and metadata.
- oledump.py: Analyzed OLE files and inspected embedded streams.
## Steps

*Ref 1*
![Screenshot (6)](https://github.com/Casttllee/Malware-Analysis/assets/137667912/afcbf0df-e734-49da-b78a-4973bf7b965e)
  I began by confirming that the `factura.zip` file was successfully downloaded and extracted. After unzipping the file, I used the `file` command to determine its type. The output indicated that the file was identified as an RTF (Rich Text Format) document.

To further investigate, I utilized the ls -lh command to check the file size and other details, confirming the file’s characteristics and ensuring there were no anomalies.

*Ref 2*
![Screenshot (7)](https://github.com/Casttllee/Malware-Analysis/assets/137667912/92a05213-ee30-494b-ad8e-b91b7e235a68)
  Next, I used the `ExifTool` command to examine the timestamps and metadata of the file. This provided detailed insights into the file’s creation, modification, and access times, as well as any additional embedded information, enhancing my understanding of the file’s history and attributes.

*Ref 3*
![Screenshot (8)](https://github.com/Casttllee/Malware-Analysis/assets/137667912/797c4278-2a58-4021-84b6-b496709b2b7d)
  I then took note of the document type, RTF, and explored the available tools in REMnux for analyzing such files. I identified two relevant tools that offered useful options for further examination of the RTF file, facilitating a more in-depth analysis of its contents and potential security implications.

*Ref 4*
![Screenshot 2024-05-28 171357](https://github.com/Casttllee/Malware-Analysis/assets/137667912/9fe3db7d-98f9-4d7d-8428-aeaa9d8cea81)
  I then executed `rtfdump.py -h` to access the help menu and understand the tool's functionality. The top of the help output indicated "Analyze RTF files," confirming that this tool was well-suited for examining the RTF file in question.
*Ref 5*
![Screenshot (9)](https://github.com/Casttllee/Malware-Analysis/assets/137667912/d6a7b584-c87d-48c3-9c0d-e9e4a7a450c6)
  Next, I checked the other RTF object analysis tool by using the command `rtfobj -h`. The information provided was unclear about the specific analysis capabilities of the tool, making it uncertain how it would address the examination of RTF files.

*Ref 6*
![Screenshot 2024-05-28 151801](https://github.com/Casttllee/Malware-Analysis/assets/137667912/a98b8b47-d135-4e5d-bb00-40ca04da311b)
  I then used Google to research the purpose of "rtfobj," discovering that it is a Python module designed for creating and extracting embedded objects within RTF files, such as OLE objects. This clarified the tool's function and its relevance for analyzing embedded content in RTF documents.

*Ref 7*
![Screenshot (11)](https://github.com/Casttllee/Malware-Analysis/assets/137667912/d50e5872-f567-4f90-b4f3-7bfba95f6737)
  I then used the command `rtfdump.py factura.doc` to further analyze the document file. During the examination, I identified two risky keywords related to embedded objects, which could potentially indicate security concerns or malicious content within the RTF file.

*Ref 8*
![Screenshot (13)](https://github.com/Casttllee/Malware-Analysis/assets/137667912/f1b763d4-5bdf-4191-8f5f-f403f5df7334)
  I then used `rtfdump` to delve into the objects by selecting their stream numbers. The initial dump was in hexadecimal format, making it challenging to interpret. To decode the hexadecimal data, I used the same command with the `-H` option. I referred to the help menu with the `-h` flag to assist in understanding and executing the command correctly.

*Ref 9*
![Screenshot 2024-05-28 152245](https://github.com/Casttllee/Malware-Analysis/assets/137667912/70d56875-6812-46b8-8ca8-f65a61ba04e3)
  The next step involved drilling into the first stream, which produced output including the phrases "Root Entry" and "Equation Native." This indicated the presence of specific entries and potentially embedded elements within the RTF file.

*Ref 10*
![Screenshot (14)](https://github.com/Casttllee/Malware-Analysis/assets/137667912/56e10e04-6a66-4d97-a8af-128492da39aa)
  Continuing with the process, I used the `rtfobj` tool on the file. The output identified vulnerabilities associated with CVE-2017-11882 and CVE-2018-0802. The tool indicated that the content within the RTF file could potentially be used to exploit these known vulnerabilities, highlighting possible security risks.
  
*Ref 11*
![Screenshot (15)](https://github.com/Casttllee/Malware-Analysis/assets/137667912/53a549b6-4af8-49df-91ab-99559cebc26d)
  Next, I saved all the objects from the RTF file by using the command `rtfobj -s all factura.doc`. This command extracted the objects and saved them to a file named `factura.doc object 00000CB6.bin`.

*Ref 12*
![Screenshot (16)](https://github.com/Casttllee/Malware-Analysis/assets/137667912/42de39f5-b4b1-4375-98f6-d6295dad13ac)
  Afterwards, I used the `file` command on the newly created binary file. The output indicated that it was a Composite Document File V2, suggesting that the binary contained structured data consistent with this file format.

*Ref 13*
![Screenshot 2024-05-28 152456](https://github.com/Casttllee/Malware-Analysis/assets/137667912/33f78706-6371-41f9-b3e4-2494d34792b6)
  Following this, I used the command `xxd` on the document to examine its hexadecimal content. The first few bytes were `d0cf 11e0`, which indicated the file's signature. I then referred to Gary Kesler's website to look up file signatures and gather more information about the file format associated with these bytes.

*Ref 14*
![Screenshot (17)](https://github.com/Casttllee/Malware-Analysis/assets/137667912/96431b58-6057-413d-995a-537981aa0b58)
  Building on that, I searched for "Gary Kessler file signature" online. The first link that appeared was "Garykessler.net," where I found relevant information about file signatures and their associated formats.

*Ref 15*
![Screenshot (18)](https://github.com/Casttllee/Malware-Analysis/assets/137667912/9df9b571-b2c3-40a4-bb46-0584e3a8901b)
  Proceeding to the next step, I searched Gary Kessler's website using the first bytes from the file. This search revealed that the file is associated with an OLE (Object Linking and Embedding) file format.

*Ref 16*
![Screenshot (19)](https://github.com/Casttllee/Malware-Analysis/assets/137667912/0dece429-3568-4511-8aaa-6e1d7ab89387)
  Next, I used the command `ole` to generate a list of tools available for analyzing OLE files. I then ran the command `oledump.py -h` to view detailed information about the tool and its usage options for examining the OLE file.

*Ref 17*
![Screenshot (21)](https://github.com/Casttllee/Malware-Analysis/assets/137667912/3baa2e39-4fed-438e-9ebd-0069f38c4870)
  To advance further, I directed the `oledump.py` command to the `factura.doc` file with the extracted object binary. However, the output indicated that nothing could be read from the file, suggesting that the content might be shell code or otherwise obfuscated.

*Ref 18*
![Screenshot (23)](https://github.com/Casttllee/Malware-Analysis/assets/137667912/412b8f6b-4731-45e9-b64c-1bfc3befe4b9)
  Following this, I used the tool "scbg," a shell code analyzer integrated into REMnux. The tool launched a graphical user interface (GUI), where I uploaded the file. The tool then analyzed the file and provided output, including any detected shell code, which was searched for using the built-in functionality.

*Ref 19*
![Screenshot 2024-05-28 153051](https://github.com/Casttllee/Malware-Analysis/assets/137667912/3c221f64-fe39-4d97-b929-f83ee3f32c9c)
  Building on that, the output from the analysis showed seven entry points with the function `GetProcAddress`. This function is used to retrieve the address of an exported function or variable from a DLL (Dynamic Link Library), indicating that the file may be interacting with or leveraging external libraries.

*Ref 20*
![Screenshot (24)](https://github.com/Casttllee/Malware-Analysis/assets/137667912/2551cbf8-2d10-410c-8dce-08921c3e14f9)
  Afterward, I selected the first index, which was 0. The analysis revealed that an executable named `aro.exe` was placed in the `AppData` path. The shell code was designed to load a library called `UrlMon` and instructed it to download a file from a URL ending in `.exe`. This downloaded file was then saved to the `AppData` path under the name `aro.exe`.

*Ref 21*
![Screenshot (25)](https://github.com/Casttllee/Malware-Analysis/assets/137667912/4fdf844c-7bb6-453e-9d06-f50007514df1)
  Lastly, I returned to VirusTotal to conduct further investigation. This allowed me to analyze the `aro.exe` file and other relevant components for potential security threats and obtain additional information on their characteristics.

*Ref 22*
![Screenshot (26)](https://github.com/Casttllee/Malware-Analysis/assets/137667912/62135d6f-f445-47c7-a79a-4617680c9ce9)


## Conculsion
Upon completing this static malware analysis lab, I identified that the exploit running on the victim machine was an RTF exploit. The analysis revealed the relevant CVE code, CVE-2017-11882. Additionally, I discovered the name of the malicious software downloaded as a result of the exploit, jan2.exe. Through VirusTotal, I obtained the IP address and port information it communicates with (Ref 22). Finally, the analysis showed that the malware drops an executable named aro.exe to disk after execution.
