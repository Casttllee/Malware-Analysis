# Malware-Analysis
Malware Analysis Lab with REMNUX. Performed Static Analysis.
## Objective
Utilize REMnux to perform static analysis on a malicious file, aiming to identify its characteristics, functionality, and potential threats without executing the file. This analysis will involve examining the file's structure, extracting embedded data, and leveraging specialized tools to understand its code and behavior.

### Skills Learned
- Static Analysis Techniques: Mastered methods for analyzing malware without execution, ensuring a safe examination environment.
- File Disassembly and Decompilation: Learned to disassemble and decompile binaries to understand the underlying code and functionality.
- Tool Proficiency: Gained expertise in using REMnux tools such as strings, hexdump, binwalk, and others for in-depth file analysis.
- Hex and Binary Analysis: Analyzed the hexadecimal and binary content of files to uncover hidden information and embedded data.
- Reporting: Enhanced skills in documenting findings and creating detailed reports on malware characteristics and potential threats.

### Tools Used
- scdbg: Analyzed shellcode and identified potential entry points and functions.
- xxd: Viewed file content in hexadecimal format.
- rtfobj: Extracted embedded objects from RTF files.
- ExifTool: Extracted and analyzed file timestamps and metadata.
- oledump.py: Analyzed OLE files and inspected embedded streams.
## Steps

*Ref 1*
![Screenshot (6)](https://github.com/Casttllee/Malware-Analysis/assets/137667912/afcbf0df-e734-49da-b78a-4973bf7b965e)
  I started by making sure the factura.zip was downloaded and unzipped. I then proceeded to use the "file" command to see what the file actually is. Based on the command, the file apperars to be a RTF or rich text format. The command I used was "ls -lh" to see how large the file was.

*Ref 2*
![Screenshot (7)](https://github.com/Casttllee/Malware-Analysis/assets/137667912/92a05213-ee30-494b-ad8e-b91b7e235a68)
  The next step I performed was using the command "ExifTool" to take a look at some of the timestamps.

*Ref 3*
![Screenshot (8)](https://github.com/Casttllee/Malware-Analysis/assets/137667912/797c4278-2a58-4021-84b6-b496709b2b7d)
  I then typed the type of document the file was, RTF, to show the tools that exist in remnux. Two tools came up that help analyze the file.

*Ref 4*
![Screenshot 2024-05-28 171357](https://github.com/Casttllee/Malware-Analysis/assets/137667912/9fe3db7d-98f9-4d7d-8428-aeaa9d8cea81)
  I then ran "rtfdump.py -h" to access the help menu and to see what this tools does. At the top it says "Analyze RTF files" which is perfect for the task.

*Ref 5*
![Screenshot (9)](https://github.com/Casttllee/Malware-Analysis/assets/137667912/d6a7b584-c87d-48c3-9c0d-e9e4a7a450c6)
  The next step I completed was checking the other RTF object tool by using the commmand "rtfobj -h". The information given didn't tell what it was trying to analyze.

*Ref 6*
![Screenshot 2024-05-28 151801](https://github.com/Casttllee/Malware-Analysis/assets/137667912/a98b8b47-d135-4e5d-bb00-40ca04da311b)
  I then used Google to see the purpose of "rtfobj" which is a python module used to create and extract embedded objects stored in RTF files, such as OLE objects.

*Ref 7*
![Screenshot (11)](https://github.com/Casttllee/Malware-Analysis/assets/137667912/d50e5872-f567-4f90-b4f3-7bfba95f6737)
  I then used the command "rtfdump.py factura.doc" to further analyse the doc file. Two risky keywords that appeared were two objects.

*Ref 8*
![Screenshot (13)](https://github.com/Casttllee/Malware-Analysis/assets/137667912/f1b763d4-5bdf-4191-8f5f-f403f5df7334)
  I then used RTF dump to drill into the objects by selecting their stream number. The inital dump was in heximal format. I then used the same command but this time with "-H" to decode the heximal. I used the help menu "-h" to help me figure this command.

*Ref 9*
![Screenshot 2024-05-28 152245](https://github.com/Casttllee/Malware-Analysis/assets/137667912/70d56875-6812-46b8-8ca8-f65a61ba04e3)
  The next step I performed was drilling into the first stream, which output the words "Root Entry" and "Equation Native".

*Ref 10*
![Screenshot (14)](https://github.com/Casttllee/Malware-Analysis/assets/137667912/56e10e04-6a66-4d97-a8af-128492da39aa)
  Continuing with the process, I used the other tool rtfobj on the file. CVE-2017-11882 and CVE-2018-0802 came up as some of the outut.The tool told me that whatever is in the code, could be used to exploit a certain vulnerability. 
  
*Ref 11*
![Screenshot (15)](https://github.com/Casttllee/Malware-Analysis/assets/137667912/53a549b6-4af8-49df-91ab-99559cebc26d)
  Next, I saved all the objects by using the command "rtfobj -s all factura.doc". The command saved the file to "factura.doc object 00000CB6.bin".

*Ref 12*
![Screenshot (16)](https://github.com/Casttllee/Malware-Analysis/assets/137667912/42de39f5-b4b1-4375-98f6-d6295dad13ac)
  Afterwards, I used the file command on the newly created binay. The output stated that it was a composite document file V2.

*Ref 13*
![Screenshot 2024-05-28 152456](https://github.com/Casttllee/Malware-Analysis/assets/137667912/33f78706-6371-41f9-b3e4-2494d34792b6)
  Following this, I used the command xxd on the document to look at the hexadecimal. The first couple of bytes are "d0cf 11e0", knowing this I looked up file signatures on Gary Kesler's website to get more information on the file.

*Ref 14*
![Screenshot (17)](https://github.com/Casttllee/Malware-Analysis/assets/137667912/96431b58-6057-413d-995a-537981aa0b58)
  Building on that, I searched up "Gary Kessler file signature" online. It is the first link shown, "Garykessler.net".

*Ref 15*
![Screenshot (18)](https://github.com/Casttllee/Malware-Analysis/assets/137667912/9df9b571-b2c3-40a4-bb46-0584e3a8901b)
  Proceeding to the next step, I searched his website with the first bytes from the file. This showed that it is linked to an OLE file.

*Ref 16*
![Screenshot (19)](https://github.com/Casttllee/Malware-Analysis/assets/137667912/0dece429-3568-4511-8aaa-6e1d7ab89387)
  Next, I then used the command "ole" to get a list of tools I can use to analyze the file. I proceeded to use the "oledump.py -h" command to see some details.

*Ref 17*
![Screenshot (21)](https://github.com/Casttllee/Malware-Analysis/assets/137667912/3baa2e39-4fed-438e-9ebd-0069f38c4870)
  To advance further, I directed the oledump.py command to the factura.doc with the object bin. Nothing was able to be read which gave te impression that it might be shell code.

*Ref 18*
![Screenshot (23)](https://github.com/Casttllee/Malware-Analysis/assets/137667912/412b8f6b-4731-45e9-b64c-1bfc3befe4b9)
  Following this, I used the tool "scbg" which is a shell code analyzer built into REMnux. This brought up a gui which I then uploaded the file which will give output the tool can find to my machine as well as finding sc, which will search for shell code.

*Ref 19*
![Screenshot 2024-05-28 153051](https://github.com/Casttllee/Malware-Analysis/assets/137667912/3c221f64-fe39-4d97-b929-f83ee3f32c9c)
  Building on that, the output prodced showed seven entry points that have a function of "GetProcAddress", which is a function that retrieves the address of an exported function or variable form, dll.

*Ref 20*
![Screenshot (24)](https://github.com/Casttllee/Malware-Analysis/assets/137667912/2551cbf8-2d10-410c-8dce-08921c3e14f9)
  Afterward, I seleted the first index, which was 0. An executable, aro.exe, was placed in the path app data. The shell code is instructed to load a library called "UrlMon". It then tells it to download a file from an URL with a .exe. This would put the file in the application data path called aro.exe

*Ref 21*
![Screenshot (25)](https://github.com/Casttllee/Malware-Analysis/assets/137667912/4fdf844c-7bb6-453e-9d06-f50007514df1)
  Lastly, I went back on VirusTotal to investigate more.

*Ref 22*
![Screenshot (26)](https://github.com/Casttllee/Malware-Analysis/assets/137667912/62135d6f-f445-47c7-a79a-4617680c9ce9)


## Conculsion
Upon completing this static malware analysis lab, I identified that the exploit running on the victim machine was an RTF exploit. The analysis revealed the relevant CVE code, CVE-2017-11882. Additionally, I discovered the name of the malicious software downloaded as a result of the exploit, jan2.exe. Through VirusTotal, I obtained the IP address and port information it communicates with (Ref 22). Finally, the analysis showed that the malware drops an executable named aro.exe to disk after execution.
